<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/news.css" />
  </head>

  <body class="input">
    <section id="input">
      <div id="form" class="news">
      </div>
      <!-- <button id="btnSubmit" onclick="generateImage()">Generate image</button> -->
    </section>

    <div id="canvas" class="news">
      <div id="overlay"></div>
      <div id="text" class="top left">
        <h1 id="h1"></h1>
        <h2 id="h2"></h2>
      </div>

      <img id="logo" class="small top left" src="img/logo_small.png" />
    </div>

    <section id="download">
      <button id="btn-download" onclick="downloadImage('news_')">Download image</button>
    </section>

    <script type="text/javascript" src="js/html2canvas.min.js"></script>
    <script type="text/javascript" src="js/canvas2image.js"></script>
    <script type="text/javascript" src="js/mapping.js"></script>
    <script type="text/javascript">
      window.onload = function() {
        generateForm();
      };

      function autosize(){
        var el = this;
        setTimeout(function(){
          el.style.cssText = 'height:auto; padding:0';
          // for box-sizing other than "content-box" use:
          // el.style.cssText = '-moz-box-sizing:content-box';
          el.style.cssText = 'height:' + el.scrollHeight + 'px';
          el.style.resize = "none";
        },0);
      }

      function generateForm() {
        var roofline = document.createElement('textarea');
        roofline.placeholder = "Roofline";
        roofline.style.resize = "none";
        roofline.addEventListener('keydown', autosize);

        var headline = document.createElement('textarea');
        headline.placeholder = "Headline";
        headline.style.resize = "none";
        headline.addEventListener('keydown', autosize);

        var h1 = document.getElementById('h1');
        var h2 = document.getElementById('h2');
        h1.appendChild(roofline);
        h2.appendChild(headline);

        document.getElementById('form').insertAdjacentHTML(
          'beforeend',
          '<div class="formGroup"><label for="bg_image">Background Image</label><input type="file" id="bg_image" name="bg_image" /></div>' +
          '<div class="formGroup"><div><label for="posX">Text Horizontal Position</label>' +
          '<select id="posX">' +
          '<option value="top">Top</option>' +
          '<option value="bottom">Bottom</option>' +
          '</select>' +
          '</div>' +
          '<label for="posY">Text Vertical Position</label>' +
          '<select id="posY">' +
          '<option value="left">Left</option>' +
          '<option value="right">Right</option>' +
          '</select></div>' +
          '<div class="formGroup"><label for="imageLeft">Image Horizontal Position</label>' +
          '<input id="imgX" type="number" min="0" max="100" placeholder="0 â€“ 100" />' +
          '</div>'
        );
        addEventListeners();
      }

      function addEventListeners() {
        var posX = document.getElementById('posX');
        var posY = document.getElementById('posY');

        posX.addEventListener('change', function() {
          document.getElementById('text').className = posX.value + " " + posY.value;
          document.getElementById('logo').className = "small " + posX.value + " " + posY.value;
        });

        posY.addEventListener('change', function() {
          document.getElementById('text').className = posX.value + " " + posY.value;
          document.getElementById('logo').className = "small " + posX.value + " " + posY.value;
        });

        // document.getElementById('btnSubmit').addEventListener('click', readURL, true);
      }

      function readURL(){
        var file = document.getElementById('bg_image').files[0];
        var reader = new FileReader();

        reader.onloadend = function(){
          document.getElementById('canvas').style.backgroundImage = "url(" + reader.result + ")";
        }

        if(file){
          reader.readAsDataURL(file);
        }
        else{
        }
      }

      function createObject() {
        article.length = 0;
        article.roofline = document.getElementById('roofline').value;
        article.headline = document.getElementById('headline').value;
        article.x = document.getElementById('posX').value;
        article.y = document.getElementById('posY').value;
      }

      function generateImage() {
        document.getElementById('text').className = "";
        document.getElementById('logo').className = "small";

        document.getElementById('canvas').style.display = "block";
        document.getElementById('canvas').style.backgroundSize = "cover";
        document.getElementById('canvas').style.backgroundPositionX = document.getElementById('imgX').value + "%";
        createObject();

        document.getElementById('h1').innerHTML = article.roofline;

        document.getElementById('h2').innerHTML = article.headline;

        document.getElementById('text').classList.add(article.x);
        document.getElementById('text').classList.add(article.y);

        document.getElementById('logo').classList.add(article.x);
        document.getElementById('logo').classList.add(article.y);

        document.getElementById('canvas').scrollIntoView();
      }
    </script>

  </body>
</html>
