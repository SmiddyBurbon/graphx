<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
  </head>

  <body class="input">
    <div id="canvas" class="drivers">
      <div class="headline">
        <div id="country"></div>
        <div id="event">
          <h1><input id="inputH1" type="text" value="Rennergebnis" /></h1>
          <h2><input id="inputH2" type="text" placeholder="E-Prix" /></h2>
        </div>
      </div>

      <div id="ranking">
      </div>

      <img id="logo" class="small" src="img/logo_small.png" />
    </div>

    <section class="download">
      <button id="btn-download" onclick="downloadImage()">Download image</button>
      <p class="hint">If the download doesn't start, right click the generated image below to save it on your device.</p>
    </section>

    <script type="text/javascript" src="js/html2canvas.min.js"></script>
    <script type="text/javascript" src="js/canvas2image.js"></script>
    <script type="text/javascript" src="js/mapping.js"></script>
    <script type="text/javascript">
      window.onload = function() {
        generateForm();
      };

      function generateForm() {
        for (let i = 1; i < 13; i++) {
          var div = document.createElement('div');
          div.className = "driver";
          div.id = "driver" + i;

          var pos = document.createElement('input');
          pos.className = "position";
          pos.type = "text";
          pos.value = i;

          var person = document.createElement('div');
          person.className = "person";

          var flag = document.createElement('img');
          flag.className = "flag";
          person.appendChild(flag);

          var name = document.createElement('input');
          name.className = "name";
          name.type = "text";
          name.placeholder = "Driver Name";
          person.appendChild(name);

          var gap = document.createElement('input');
          gap.className = "gap";
          gap.type = "text";
          gap.placeholder = "+ 0.000";
          person.appendChild(gap);

          var car = document.createElement('img');
          car.className = "car";
          person.appendChild(car);

          document.getElementById('ranking').appendChild(div);
          div.appendChild(pos);
          div.appendChild(person);
        }
        addEventListeners();
      }

      function addEventListeners() {
        var h2 = document.getElementById('inputH2');
        h2.addEventListener('change', function() {
          var div = document.getElementById('country');
          var img = document.createElement('img');
          img.className = "flag";
          img.id = "countryFlag";
          img.src = "img/flags/" + getCountry(h2.value) + ".png";
          div.appendChild(img);
        });

        for(let i = 0; i < 12; i++) {
          let driver = document.getElementsByClassName('driver')[i].childNodes[1];
          let flag = driver.childNodes[0];
          let name = driver.childNodes[1];
          let car = driver.childNodes[3];
          name.addEventListener("change", function() {
            flag.src = "img/flags/" + getNationality(this.value) + ".png";
            car.src = "img/cars/" + getTeam(this.value) + ".png";
          });
        }
      }

      function downloadImage() {
        var canvas = document.getElementById('canvas');
        html2canvas(canvas).then(function(canvas) {
            canvas.id = "image";
            document.body.appendChild(canvas);
            Canvas2Image.saveAsPNG(canvas, 1200, 1200);
            canvas.style.display = "none";
        });
      }
    </script>

  </body>
</html>
